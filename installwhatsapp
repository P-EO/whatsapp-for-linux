#!/bin/bash

#Identifying the system package manager
declare -A osInfo;
osInfo[/etc/redhat-release]=yum
osInfo[/etc/arch-release]=pacman
osInfo[/etc/gentoo-release]=emerge
osInfo[/etc/SuSE-release]=zypp
osInfo[/etc/debian_version]=apt

for f in ${!osInfo[@]}
do
    if [[ -f $f ]]; then
        echo Package manager: ${osInfo[$f]} 
        packagemanager=${osInfo[$f]}
    fi
done

if packagemanager=zypp; then sudo apt update
elif packagemanager=dnf; then sudo dnf 
elif packagemanager=apt; then sudo yum update
elif packagemanager=zypp; then sudo 
else echo "FAILED TO INSTALL PACKAGE: Package manager not found. You must manually install: $packagesNeeded">&2; fi


#Download prerequisites to nativefy WhatsApp
echo -e '\e[32mPreparing...\e[39m'
wget -qO- https://deb.nodesource.com/setup_16.x | sudo bash -

sudo apt update && sudo apt install npm nodejs -y
npm install -g nativefier
sudo mkdir WhatsApp
cd Whatsapp
wget https://raw.githubusercontent.com/ITdairy/whatsapp-nativefier-script/main/run-whatsapp.sh
wget https://raw.githubusercontent.com/ITdairy/whatsapp-nativefier-script/main/whatsapp.desktop
 
#Nativefier WhatsApp with user agent
echo -e '\e[32mNativefying WhatsApp from http://web.whatsapp.com ...\e[39m'
nativefier https://web.whatsapp.com --user-agent "Mozilla/5.0 (X11; CrOS armv7l 13597.84.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.187 Safari/537.36" -a `uname -m` --maximize -n WhatsApp
cd ./WhatsApp-linux-`uname -m`
sudo cp ../run-whatsapp.sh ./
sudo chmod +x ./run-whatsapp.sh
cd ..
echo -e '\e[32mDone installing WhatsApp, Creating desktop shortcut and menu shortcut...'

#Create desktop & menu shortcut
sudo cp ./whatsapp.desktop /usr/share/applications
sudo cp ./whatsapp.desktop ~/Desktop
echo -e '\e[32mDone! You can now run WhatsApp from desktop and menu bar.\e[39m'
echo -e "\e[101mPlease let me know if you can't see desktop shortcut and menu bar shortcut!\e[0m"
cd ~/

